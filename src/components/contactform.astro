---
import Button from "./ui/button.astro";
---

<!-- YOLOVibeCode Contact Form -->
<div class="space-y-6">
  <div class="text-center mb-8">
    <h3 class="text-2xl font-bold text-white mb-2">Send Us a Message</h3>
    <p class="text-slate-400">Ready to accelerate your development journey? Let's talk!</p>
  </div>

  <form
    action="https://api.web3forms.com/submit"
    method="POST"
    id="form"
    class="needs-validation space-y-6"
    novalidate>
    <input type="hidden" name="access_key" value="YOUR_ACCESS_KEY_HERE" />
    <!-- Create your free access key from https://web3forms.com/ -->
    <input type="checkbox" class="hidden" style="display:none" name="botcheck" />
    
    <div class="space-y-2">
      <label for="contact-name" class="block text-white font-semibold text-sm">Full Name</label>
      <input
        id="contact-name"
        type="text"
        placeholder="Enter your full name"
        required
        name="name"
        class="w-full px-4 py-3 bg-black/30 border border-indigo-500/30 text-white placeholder-slate-400 rounded-lg focus:border-cyan-400 focus:ring-2 focus:ring-cyan-400/20 transition-all"
      />
      <div class="empty-feedback invalid-feedback text-red-400 text-sm mt-1">
        Please provide your full name.
      </div>
    </div>
    
    <div class="space-y-2">
      <label for="contact-email" class="block text-white font-semibold text-sm">Email Address</label>
      <input
        id="contact-email"
        type="email"
        placeholder="your@email.com"
        name="email"
        required
        class="w-full px-4 py-3 bg-black/30 border border-indigo-500/30 text-white placeholder-slate-400 rounded-lg focus:border-cyan-400 focus:ring-2 focus:ring-cyan-400/20 transition-all"
      />
      <div class="empty-feedback text-red-400 text-sm mt-1">
        Please provide your email address.
      </div>
      <div class="invalid-feedback text-red-400 text-sm mt-1">
        Please provide a valid email address.
      </div>
    </div>
    
    <div class="space-y-2">
      <label for="contact-message" class="block text-white font-semibold text-sm">Your Message</label>
      <textarea
        id="contact-message"
        name="message"
        required
        placeholder="Tell us about your AI development goals, workshop interests, or any questions you have..."
        rows="6"
        class="w-full px-4 py-3 bg-black/30 border border-indigo-500/30 text-white placeholder-slate-400 rounded-lg focus:border-cyan-400 focus:ring-2 focus:ring-cyan-400/20 transition-all resize-none"
      ></textarea>
      <div class="empty-feedback invalid-feedback text-red-400 text-sm mt-1">
        Please enter your message.
      </div>
    </div>
    
    <button 
      type="submit" 
      class="w-full py-4 bg-gradient-to-r from-purple-600 via-pink-600 to-cyan-600 hover:from-purple-700 hover:via-pink-700 hover:to-cyan-700 text-white font-bold rounded-lg transition-all transform hover:scale-105 shadow-lg hover:shadow-2xl focus:ring-4 focus:ring-purple-500/50"
    >
      <span class="flex items-center justify-center">
        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
          <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path>
          <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path>
        </svg>
        Send Message
      </span>
    </button>
    
    <div id="result" class="text-center text-sm"></div>
  </form>
</div>

<style>
  .invalid-feedback,
  .empty-feedback {
    display: none;
  }

  .was-validated :placeholder-shown:invalid ~ .empty-feedback {
    display: block;
  }

  .was-validated :not(:placeholder-shown):invalid ~ .invalid-feedback {
    display: block;
  }

  .is-invalid,
  .was-validated :invalid {
    border-color: #dc3545;
  }
</style>

<script is:inline>
  const form = document.getElementById("form");
  const result = document.getElementById("result");

  form.addEventListener("submit", function (e) {
    e.preventDefault();
    form.classList.add("was-validated");
    if (!form.checkValidity()) {
      form.querySelectorAll(":invalid")[0].focus();
      return;
    }
    const formData = new FormData(form);
    const object = Object.fromEntries(formData);
    const json = JSON.stringify(object);

    // Show loading state
    result.innerHTML = `
      <div class="flex items-center justify-center text-cyan-400">
        <svg class="animate-spin -ml-1 mr-3 h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        Sending your message...
      </div>
    `;

    fetch("https://api.web3forms.com/submit", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        Accept: "application/json",
      },
      body: json,
    })
      .then(async (response) => {
        let json = await response.json();
        if (response.status == 200) {
          result.innerHTML = `
            <div class="flex items-center justify-center text-green-400 bg-green-900/20 border border-green-500/30 rounded-lg p-3">
              <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
              </svg>
              ${json.message || 'Message sent successfully! We\'ll get back to you soon.'}
            </div>
          `;
        } else {
          console.log(response);
          result.innerHTML = `
            <div class="flex items-center justify-center text-red-400 bg-red-900/20 border border-red-500/30 rounded-lg p-3">
              <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
              </svg>
              ${json.message || 'Failed to send message. Please try again.'}
            </div>
          `;
        }
      })
      .catch((error) => {
        console.log(error);
        result.innerHTML = `
          <div class="flex items-center justify-center text-red-400 bg-red-900/20 border border-red-500/30 rounded-lg p-3">
            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
            </svg>
            Something went wrong! Please try again or contact us directly.
          </div>
        `;
      })
      .then(function () {
        form.reset();
        form.classList.remove("was-validated");
        setTimeout(() => {
          result.innerHTML = "";
        }, 5000);
      });
  });
</script>
